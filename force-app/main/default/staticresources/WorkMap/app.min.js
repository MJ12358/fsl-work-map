!function(){"use strict";const e="vf.workMap.selectedStyle",t=document.getElementById("map"),o={fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},gestureHandling:"greedy",mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!1,styles:[],zoomControl:!1},l=new google.maps.Map(t,o),s=new google.maps.visualization.HeatmapLayer,r=new geoXML3.parser({map:null,suppressInfoWindows:!0,zoom:!1}),a=new google.maps.TrafficLayer,n=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.MARKER,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER},markerOptions:{icon:`${resourceUrl}/assets/flag.png`}}),i=3958.8,y=[{featureType:"administrative",elementType:"geometry",stylers:[{}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{}]},{featureType:"poi",stylers:[{}]},{featureType:"road",elementType:"labels.icon",stylers:[{}]},{featureType:"transit",stylers:[{}]}];function p(e){let t=e.Latitude+h(),o=e.Longitude+h();this.animation=google.maps.Animation.DROP,this.icon=w(e.Status),this.id=e.Id,this.map=l,this.ownerId=e.OwnerId,this.position=new google.maps.LatLng(t,o),this.status=e.StatusCategory,this.title=d(e.Label),this.infoWindow=T({Id:e.Id,Number:e.AppointmentNumber,Status:e.Status,"Work Type":e.WorkTypeName,Account:e.AccountName,Contact:e.ContactName,Address:f(e)})}function c(e){let t=e.Latitude+h(),o=e.Longitude+h();this.animation=google.maps.Animation.DROP,this.icon=w(e.Status),this.id=e.Id,this.map=l,this.ownerId=e.OwnerId,this.position=new google.maps.LatLng(t,o),this.status=e.StatusCategory,this.title=d(e.Label),this.infoWindow=T({Id:e.Id,Number:e.WorkOrderNumber,Status:e.Status,"Work Type":e.WorkTypeName,Account:e.AccountName,Contact:e.ContactName,Address:f(e)})}function m(e){let t=e.Latitude+h(),o=e.Longitude+h();this.animation=google.maps.Animation.DROP,this.icon=`${resourceUrl}/assets/pin_location.png`,this.id=e.Id,this.map=l,this.position=new google.maps.LatLng(t,o),this.title=d(e.Name),this.infoWindow=T({Id:e.Id,Name:e.Name,Type:e.Type,"Open Date":b(e.OpenDate),Address:f(e)})}function g(e){let t=e.Latitude+h(),o=e.Longitude+h();this.animation=google.maps.Animation.DROP,this.icon=`${resourceUrl}/assets/pin_resource.png`,this.id=e.Id,this.map=l,this.position=new google.maps.LatLng(t,o),this.title=d(e.Name),this.infoWindow=T({Id:e.Id,Name:e.Name,Label:e.Label,"Last Seen":b(e.LastKnownLocationDate)})}function u(e){let t=e.Latitude+h(),o=e.Longitude+h();this.animation=google.maps.Animation.DROP,this.icon=`${resourceUrl}/assets/pin_territory.png`,this.id=e.Id,this.map=l,this.position=new google.maps.LatLng(t,o),this.title=d(e.Name),this.infoWindow=T({Id:e.Id,Name:e.Name,Address:f(e)})}function d(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}function f(e){return[e.Street,e.City,e.State,e.PostalCode,e.Country].filter((e=>e)).join(", ")}function T(e){let t="<table>";for(let[o,l]of Object.entries(e))o&&l&&"Id"!=o&&(t+="<tr>",t+=`<th>${o}</th>`,t+=`<td>${l}</td>`,t+="</tr>");return t+="</table>",e.Id&&(t+=`<a href="/${e.Id}" target="_blank">View in Salesforce</a>`),t}function h(){let e=Math.random()/4e3;return 4e5*e%2==0?e:-e}function b(e,t){return e?(t||(t="ddd MMM D YYYY h:mm A"),dayjs(parseInt(e)).format(t)):""}function w(e){switch(e){case"Scheduled":return`${resourceUrl}/assets/pin_scheduled.png`;case"Dispatched":return`${resourceUrl}/assets/pin_dispatched.png`;case"New":return`${resourceUrl}/assets/pin_new.png`;case"In Progress":return`${resourceUrl}/assets/pin_inprogress.png`;case"On Hold":return`${resourceUrl}/assets/pin_onhold.png`;case"None":default:return`${resourceUrl}/assets/pin_none.png`}}l.controls[google.maps.ControlPosition.TOP_RIGHT].push(document.getElementById("counter")),l.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(document.getElementById("legend")),l.controls[google.maps.ControlPosition.TOP_LEFT].push(document.getElementById("options")),l.controls[google.maps.ControlPosition.LEFT_TOP].push(document.getElementById("option-control")),l.controls[google.maps.ControlPosition.TOP_LEFT].push(document.getElementById("mouse-location")),l.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById("search-bar"));let k=new function(){const t=this;let o,d=[],f=[],h=!0,b=[],w=[],k=[],x=[],I=[],M=[];function O(){let e=l.getBounds(),o=[];o=h?d:I,t.visibleMarkers=o.filter((t=>e.contains(t.getPosition())&&t.getVisible()))}function L(e){y.forEach((o=>{o.stylers[0].visibility=e;for(let[,e]of Object.entries(t.styles)){let t=e.findIndex((e=>e.featureType===o.featureType&&e.elementType===o.elementType));-1===t?e.push(o):Object.assign(e[t],o)}})),l.setOptions({styles:t.styles[t.selectedStyle]})}function S(e){let t=new google.maps.InfoWindow;google.maps.event.addListener(e,"click",(function(){o?.close(),t.setContent(this.infoWindow),t.open(l,this),o=t}))}this.alertOpen=!1,this.alertTitle="",this.alertMessage="",this.currentTab="tab-1",this.mouseLocation,this.optionControlOpen=!1,this.polygons=[],this.selectedStatuses=[],this.selectedStyle=function(e){try{if(null!==localStorage)return JSON.parse(localStorage.getItem(e));if(null!==sessionStorage)return JSON.parse(sessionStorage.getItem(e))}catch(e){}}(e)||"default",this.searchValue="",this.statuses=[],this.visibleMarkers=[],this.styles={default:[],silver:[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}],dark:[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3d3d3d"}]}],night:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],aubergine:[{elementType:"geometry",stylers:[{color:"#1d2c4d"}]},{elementType:"labels.text.fill",stylers:[{color:"#8ec3b9"}]},{elementType:"labels.text.stroke",stylers:[{color:"#1a3646"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#64779e"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{color:"#334e87"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#023e58"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#283d6a"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#6f9ba5"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#023e58"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#3C7680"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#304a7d"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#98a5be"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#2c6675"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#255763"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#b0d5ce"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#023e58"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#98a5be"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#283d6a"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#3a4762"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0e1626"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#4e6d70"}]}],retro:[{elementType:"geometry",stylers:[{color:"#ebe3cd"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#c9b2a6"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#dcd2be"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#93817c"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#a5b076"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#447530"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f5f1e6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#fdfcf8"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#f8c967"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#e9bc62"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#e98d58"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#db8555"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#806b63"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#8f7d77"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#ebe3cd"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b9d3c2"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#92998d"}]}]},this.showAlert=function(e,o){t.alertTitle=e||"Service Unavailable",t.alertMessage=o,t.alertOpen=!0},this.closeAlert=function(){t.alertOpen=!1,t.alertTitle="",t.alertMessage=""},this.changeStyle=function(o){t.selectedStyle=o.target.value,l.setOptions({styles:t.styles[t.selectedStyle]}),function(e,t){try{t=JSON.stringify(t),null!==localStorage?localStorage.setItem(e,t):null!==sessionStorage&&sessionStorage.setItem(e,t)}catch(e){}}(e,t.selectedStyle)},this.toggleOptionControl=function(){t.optionControlOpen=!t.optionControlOpen},this.openTab=function(e){t.currentTab=e.target.getAttribute("aria-controls")},this.togglePointsOfInterest=function(e){e.target.checked?L("on"):L("off")},this.toggleLocations=function(e){w.forEach((t=>{t.setVisible(e.target.checked)}))},this.toggleResources=function(e){k.forEach((t=>{t.setVisible(e.target.checked)}))},this.toggleTerritories=function(e){x.forEach((t=>{t.setVisible(e.target.checked)}))},this.toggleDrawing=function(){n.getMap()?n.setMap(null):n.setMap(l),b.forEach((e=>{e.getMap()?e.setMap(null):e.setMap(l)}))},this.toggleHeatmap=function(){let e=[];e=h?d:I;let t=e.map((e=>{if(e.getVisible())return{location:e.getPosition(),weight:25}}));s.setOptions({data:t}),s.getMap()?s.setMap(null):s.setMap(l)},this.togglePolygons=function(){t.polygons=t.polygons.map((e=>(e.getMap()?e.setMap(null):e.setMap(l),e)))},this.togglePolygon=function(e,t){t.getVisible()?t.setVisible(!1):t.setVisible(!0)},this.toggleTraffic=function(){a.getMap()?a.setMap(null):a.setMap(l)},this.toggleAppointments=function(e){h=!0;let o=e.target.checked;document.querySelector("#checkbox-7").checked=!o,I.forEach((e=>{e.setVisible(!o)})),d.forEach((e=>{e.setVisible(o)})),Array.from(document.querySelectorAll('#tab-2 input[type="checkbox"]')).forEach((e=>{e.checked=o})),t.statuses=o?f:M,t.selectedStatuses=[...t.statuses],O()},this.toggleMyAppointments=function(e){d.forEach((t=>{e.target.checked?t.ownerId!==userId&&t.setVisible(!1):t.setVisible(!0)}))},this.toggleWorkOrders=function(e){h=!1;let o=e.target.checked;document.querySelector("#checkbox-5").checked=!o,d.forEach((e=>{e.setVisible(!o)})),I.forEach((e=>{e.setVisible(o)})),Array.from(document.querySelectorAll('#tab-2 input[type="checkbox"]')).forEach((e=>{e.checked=o})),t.statuses=o?M:f,t.selectedStatuses=[...t.statuses],O()},this.toggleMyWorkOrders=function(e){I.forEach((t=>{e.target.checked?t.ownerId!==userId&&t.setVisible(!1):t.setVisible(!0)})),O()},this.toggleStatus=function(e,o){e[0].target.checked?t.selectedStatuses.push(o):t.selectedStatuses=t.selectedStatuses.filter((e=>e!==o));let l=[];l=h?d:I,l.forEach((e=>{t.selectedStatuses.includes(e.status)?e.setVisible(!0):e.setVisible(!1)})),O()},this.onSearch=function(){let e=t.searchValue.toLowerCase(),o=[];o=h?d:I,o.forEach((t=>{e?t.title.toLowerCase().includes(e)?t.setVisible(!0):t.setVisible(!1):t.setVisible(!0)})),O()},WorkMapController.getServiceAppointments(((e,o)=>{if(o.status){let t=new google.maps.LatLngBounds;d=e.map((e=>{let o=new google.maps.Marker(new p(e));return S(o),t.extend(o.getPosition()),o})),l.fitBounds(t)}else t.showAlert(o.type,o.message)})),WorkMapController.getAppointmentStatuses(((e,o)=>{o.status?(f=e,t.statuses=e,t.selectedStatuses=e):t.showAlert(o.type,o.message)})),WorkMapController.getWorkOrders(((e,o)=>{o.status?I=e.map((e=>{let t=new google.maps.Marker(new c(e));return S(t),t.setVisible(!1),t})):t.showAlert(o.type,o.message)})),WorkMapController.getWorkOrderStatuses(((e,o)=>{o.status?M=e:t.showAlert(o.type,o.message)})),WorkMapController.getLocations(((e,o)=>{o.status?w=e.map((e=>{let t=new google.maps.Marker(new m(e));return S(t),t.setVisible(!1),t})):t.showAlert(o.type,o.message)})),WorkMapController.getResources(((e,o)=>{o.status?k=e.map((e=>{let t=new google.maps.Marker(new g(e));return S(t),t})):t.showAlert(o.type,o.message)})),WorkMapController.getTerritories(((e,o)=>{o.status?x=e.map((e=>{let t=new google.maps.Marker(new u(e));return S(t),t})):t.showAlert(o.type,o.message)})),WorkMapController.getPolygons(((e,s)=>{s.status?(e.forEach((e=>{r.parseKmlString(e.FSL__KML__c)})),r.docs.forEach((e=>{e.gpolygons.forEach((e=>{t.polygons.push(e),function(e){let s=new google.maps.InfoWindow;google.maps.event.addListener(e,"click",(function(e){let r=[];r=h?d:I,o?.close(),t.polygons.map((e=>{e.setOptions({strokeWeight:1})})),this.setOptions({strokeWeight:3});let a=r.reduce(((e,t)=>t.getVisible()&&google.maps.geometry.poly.containsLocation(t.getPosition(),this)?++e:e),0),n=google.maps.geometry.spherical.computeArea(this.getPath(),i).toFixed(2),y=T({Name:this.title,"Work Orders":a,Area:`${n} mi²`,Spread:(n/a).toFixed(2)});s.setContent(y),s.setPosition(e.latLng),s.open(l,this),o=s}))}(e)}))}))):t.showAlert(s.type,s.message)}),{escape:!1}),setInterval((()=>{I.every((e=>!e.getVisible()))||WorkMapController.getWorkOrders(((e,t)=>{t.status&&(I=I.map((t=>{let o=e.find((e=>e.Id===t.id));return o?(Object.assign(t,new c(o)),t.setIcon(t.icon)):t.setMap(null),t})))}))}),9e5),setInterval((()=>{d.every((e=>!e.getVisible()))||WorkMapController.getServiceAppointments(((e,t)=>{t.status&&(d=d.map((t=>{let o=e.find((e=>e.Id===t.id));return o?(Object.assign(t,new p(o)),t.setIcon(t.icon)):t.setMap(null),t})))}))}),9e5),setInterval((()=>{k.every((e=>!e.getVisible()))||WorkMapController.getResources(((e,t)=>{t.status&&k.forEach((t=>{let o=e.find((e=>e.Id===t.id));o?Object.assign(t,new g(o)):t.setMap(null)}))}))}),3e5),google.maps.event.addListener(l,"bounds_changed",(()=>{O()})),google.maps.event.addListener(l,"mousemove",(e=>{t.mouseLocation=`${e.latLng.lat().toFixed(4)}°N, ${e.latLng.lng().toFixed(4)}°W`})),google.maps.event.addListener(n,"overlaycomplete",(e=>{var t;n.setDrawingMode(null),b.push(e.overlay),t=e.overlay,google.maps.event.addListener(t,"contextmenu",(()=>{b=b.filter((e=>e!==t||(e.setMap(null),!1)))})),e.overlay.setOptions({draggable:!0})})),L("off")};rivets.formatters.getIcon=function(e){return w(e)},rivets.binders.keyupdelay.callback=k.onSearch,rivets.bind(document.body,k)}();